<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ post.title}}</title>
    <link rel="stylesheet" href="{% static 'grid/post-detail.css' %}">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B5CS37QY3Z"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-B5CS37QY3Z');
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>

    <div class="main">
        <div class="header">
            <div class="f-logo" data-url="/"><img src="{% static 'aset/logo.svg' %}" alt=""></div>
            <div class="nav">

                <div class="btn-n" data-url="/#con-pro">
                    What we do?
                </div>
                <div class="btn-n" data-url="/#con-work">
                    Work
                </div>
                <div class="btn-n" data-url="/about">
                    About us
                </div>
                <div class="btn-n" data-url="/#con-contact">
                    Contact us
                </div>
            </div>

            <div class="auth">
                <div class="btn-a" id="ss" data-url="{% url 'login' %}">
                    Login
                </div>
                <div class="btn-a" id="ss" data-url="{% url 'signup' %}">
                    Sign Up
                </div>
            </div>
        </div>


        <div class="con">

            <div class="sub">
                <div class="img">
                    {% if post.image %}
                    <img src="{{ post.image.url }}" alt="{{ r.title }}">
                    {% endif %}
                </div>

                <h2> {{ post.title|slice:":70" }}{% if post.title|length > 70 %}...{% endif %}</h2>

                <p> {{ post.content }}
                </p>
            </div>
            <!-- <a href="{% url 'post_update' post.slug %}">Edit</a> -->
        </div>

        <div class="comments-container">
            <h2>Leave a comment</h2>
            {% if is_auth %}
            <form id="comment-form" class="comment-form" method="post">
                {% csrf_token %}
                <!-- {{ comment_form.as_p }} -->
                <input type="hidden" name="csrfmiddlewaretoken"
                    value="Y8GlLsBBwrFl5QHPyQVMyB05h1FrkbfjXKuRpcfmSKyUcw7hPrMcVBsBSNCwBooT">
                <p>
                    <label for="id_name">Name:</label>
                    <input type="text" name="name" maxlength="80" required="" id="id_name" fdprocessedid="wyh6xi" placeholder="Name">

                </p>

                <p>
                    <label for="id_email">Email:</label>
                    <input type="email" name="email" maxlength="254" required="" id="id_email" fdprocessedid="mex7nr" placeholder="Email">

                </p>

                <p>
                    <label for="id_body">Body:</label>
                    <textarea name="body" cols="40" rows="4" required="" id="id_body" placeholder="Write comment here..."></textarea>

                </p>
                <button type="submit" class="btn-primary">Submit</button>
            </form>
            {% else %}
            <p><a href="{% url 'login' %}">Log in</a> to leave a comment.</p>
            {% endif %}

            <h2 id="cmt">Comments</h2>
            <div id="comments">
                {% for comment in comments %}
                <div class="comment">
                    <p><strong>{{ comment.name }}</strong></p>
                    <p>{{ comment.body }}</p>
                    <p><em>{{ comment.created_on }}</em></p>
                </div>
                {% endfor %}
            </div>

        </div>
    </div>

    <script>
        $(document).ready(function () {
            $('#comment-form').on('submit', function (event) {
                event.preventDefault();
                $.ajax({
                    url: "{% url 'add_comment' post.slug %}",
                    type: "POST",
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        name: $('#id_name').val(),
                        email: $('#id_email').val(),
                        body: $('#id_body').val()
                    },
                    success: function (response) {
                        $('#comments').append(
                            '<div class="comment">' +
                            '<p><strong>' + response.name + '</strong></p>' +
                            '<p>' + response.body + '</p>' +
                            '<p><em>' + response.created_on + '</em></p>' +
                            '</div>'
                        );
                        $('#comment-form')[0].reset();
                    },
                    error: function (response) {
                        alert('An error occurred. Please try again.');
                    }
                });
            });
        });

    </script>

</body>

</html>